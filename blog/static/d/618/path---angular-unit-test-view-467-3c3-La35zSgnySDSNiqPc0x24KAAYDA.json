{"data":{"site":{"siteMetadata":{"title":"","author":"Cody Stebbins"}},"markdownRemark":{"id":"03b8742a-7c04-51f8-8a3f-c68a0fc16ec1","excerpt":"In this blog post I will be focusing on how to replace integrated tests with unit tests in client-side Angular.JS applications. I originally wrote this post for…","html":"<p>In this blog post I will be focusing on how to replace integrated tests with unit tests in client-side Angular.JS applications. I originally wrote this post for my employer at the time <a href=\"https://trov.com\">Trōv</a>.</p>\n<h3>How to test an Angular view?</h3>\n<p>For example, here is a simple dropdown box with a controller that supplies the currently logged-in user.</p>\n<div class=\"gatsby-highlight\" data-language=\"language-markup\"><pre class=\"language-language-markup\"><code class=\"language-language-markup\">&lt;li class=&quot;dropdown&quot;&gt;\n  &lt;a id=&quot;email&quot; href=&quot;#&quot; data-toggle=&quot;dropdown&quot; class=&quot;dropdown-toggle&quot;&gt;\n    {{ user.email || user.name || &quot;Anon&quot; }}\n  &lt;/a&gt;\n  &lt;ul class=&quot;dropdown-menu&quot;&gt;\n    &lt;li&gt;\n      &lt;a id=&quot;logout&quot; data-ng-click=&quot;logout()&quot;&gt;\n        Logout\n      &lt;/a&gt;\n    &lt;/li&gt;\n  &lt;/ul&gt;\n&lt;/li&gt;</code></pre></div>\n<p>What are the key scenarios to be tested here? I will cover the following:</p>\n<ul>\n<li>It should display the user email when the user has an email.</li>\n<li>It should display the user name when the user has no email.</li>\n<li>It should display a default user name when the user has no email or name.</li>\n<li>It should logout when the logout button is clicked in the dropdown menu.</li>\n</ul>\n<p>What is the best way to write a test for each of these scenarios? The common answer is to write an integrated test, typically using <a href=\"http://www.protractortest.org/\">Protractor</a>.</p>\n<p>However, integrated tests have the following drawbacks associated with them:</p>\n<ul>\n<li>They force unrelated systems into the test, thereby creating room for test failures unrelated to the system under test.</li>\n<li>They are unopinionated about the design of the view, so there is no pressure for it to be broken up into smaller views, controllers, or directives.</li>\n<li>Over time, integrated tests can become slow and hard to maintain.</li>\n<li>They are fragile when changes occur in the application.</li>\n</ul>\n<p>The above four integrated tests involve the real implementation of the controller for the corresponding view, thereby leaving it exposed to bugs in that system. The fourth scenario includes the logout interaction, which could involve page transitions, database calls, updating localStorage user models, and triggering analytics events. The basic correctness of the view should not require brittle tests.</p>\n<h3>Unit Testing a View</h3>\n<p>Unit testing views can be done in Angular.js and avoids the integrated test problems mentioned earlier. These tests validate the view independent of other systems, and can be run both in parallel and in memory without spinning up the server or database. Pressure is put on the design of the view by the tests, which encourages the creation of new views and directives.</p>\n<p>An interactive example with all four scenarios is on <a href=\"http://plnkr.co/edit/k9kjPQJ644fxjcEYqeNC?p=preview\">plunkr</a>; however, the approach can be explained by the following snippets:</p>\n<div class=\"gatsby-highlight\" data-language=\"language-javascript\"><pre class=\"language-language-javascript\"><code class=\"language-language-javascript\">// Get html template from cache\nbeforeEach(inject(function($templateCache) {\n  viewHtml = $templateCache.get(&quot;some/valid/templateUrl&quot;);\n}));</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"language-javascript\"><pre class=\"language-language-javascript\"><code class=\"language-language-javascript\">// Setup stubbed scope and create dropdownElement.\nvar $rootScope;\nvar $scope;\nvar $compile;\nvar dropdownElement;\n\nbeforeEach(inject(function(_$compile_, _$rootScope_){\n  $compile = _$compile_;\n  $rootScope = _$rootScope_;\n\n  $scope = $rootScope.$new();\n  $scope.user = {};\n  $scope.logout = sinon.stub();\n  dropdownElement = angular.element(viewHtml);\n}));</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"language-javascript\"><pre class=\"language-language-javascript\"><code class=\"language-language-javascript\">// Compile element, digest cycle for stubbed scope, verify expectations\nit(&quot;should display the user email when the user has an email.&quot;, function () {\n  $scope.user.email = &quot;cody@trov.com&quot;;\n  compileElement();\n\n  var email = dropdownElement.find(&quot;#email&quot;);\n\n  expect(email.text().trim()).toBe($scope.user.email);\n});\n\nfunction compileElement() {\n  $compile(dropdownElement)($scope);\n  $rootScope.$digest();\n}</code></pre></div>\n<h3>Further Reading</h3>\n<ul>\n<li><a href=\"http://www.zealake.com/2014/01/01/unit-test-your-angularjs-views/\">Zealake’s similar approach to unit testing Angular.js views</a></li>\n<li><a href=\"http://stackoverflow.com/questions/23083645/unit-test-views-best-practice\">23tux’s similar approach to unit testing Angular.js views</a></li>\n<li><a href=\"https://robots.thoughtbot.com/angular-testing-directives\">Unit testing Angular.JS directives</a></li>\n</ul>","frontmatter":{"title":"Unit Testing Angular Views","date":"March 07, 2015"}}},"pageContext":{"slug":"/angular-unit-test-view/","previous":{"fields":{"slug":"/dstruct-tables-queues/"},"frontmatter":{"title":"Tables and Queues for dstruct"}},"next":null}}